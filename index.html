<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Even Hub Starter Kit</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: Canvas;
      --fg: CanvasText;
      --card: transparent;
      --border: color-mix(in srgb, CanvasText 12%, Canvas 88%);
      --ok: #0a7;
      --bad: #c21;
      --muted: color-mix(in srgb, CanvasText 65%, Canvas 35%);
      --accent: #376dff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      line-height: 1.45;
      background: var(--bg);
      color: var(--fg);
    }
    .app {
      max-width: 780px;
      margin: 0 auto;
      padding: 20px 14px 24px;
      display: grid;
      gap: 18px;
    }
    h1, h2, h3, p { margin: 0; }
    h1 { font-size: 1.45rem; letter-spacing: 0.01em; }
    h2 { font-size: 1rem; margin-bottom: 6px; letter-spacing: 0.01em; }
    h3 { font-size: 0.95rem; margin-bottom: 6px; }
    .muted { color: var(--muted); }
    .tiny { font-size: 0.8rem; }
    .card {
      border: 0;
      border-radius: 0;
      padding: 0;
      display: grid;
      gap: 8px;
    }
    .header-card { gap: 6px; }
    .pill-row { display: flex; flex-wrap: wrap; gap: 8px; }
    .pill {
      display: inline-block;
      border: 1px solid color-mix(in srgb, var(--border) 85%, Canvas 15%);
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 0.75rem;
      background: transparent;
    }
    .row { display: flex; flex-wrap: wrap; gap: 8px; }
    button {
      border: 1px solid var(--border);
      border-radius: 999px;
      min-height: 38px;
      padding: 8px 13px;
      font: inherit;
      font-size: 0.84rem;
      font-weight: 500;
      background: transparent;
      color: inherit;
      cursor: pointer;
      text-align: center;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .primary-btn {
      background: color-mix(in srgb, var(--accent) 8%, Canvas 92%);
      border-color: color-mix(in srgb, var(--accent) 22%, var(--border) 78%);
    }
    .step-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 8px;
    }
    .step-item {
      border: 0;
      border-left: 2px solid color-mix(in srgb, var(--border) 75%, Canvas 25%);
      border-radius: 0;
      padding: 2px 0 2px 10px;
      display: grid;
      gap: 4px;
      background: transparent;
    }
    .step-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .step-status {
      font-size: 0.72rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 2px 8px;
      font-weight: 600;
      text-transform: lowercase;
    }
    .step-status.not-run { color: #666; }
    .step-status.running { color: #a85f00; }
    .step-status.success { color: var(--ok); }
    .step-status.failed { color: var(--bad); }
    .grid { display: grid; gap: 14px; }
    .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .status-cell {
      border: 0;
      border-left: 2px solid color-mix(in srgb, var(--border) 78%, Canvas 22%);
      border-radius: 0;
      padding: 4px 0 4px 10px;
      font-size: 0.8rem;
      background: transparent;
    }
    .ok { color: var(--ok); font-weight: 700; }
    .bad { color: var(--bad); font-weight: 700; }
    textarea, input[type="search"] {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 9px;
      background: transparent;
      color: inherit;
      font: inherit;
      font-size: 0.86rem;
    }
    select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 9px;
      background: transparent;
      color: inherit;
      font: inherit;
      font-size: 0.86rem;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      margin-bottom: 0;
    }
    details[open] summary { margin-bottom: 8px; }
    #advancedPanel:not([open]) .probe-group,
    #advancedPanel:not([open]) p,
    #advancedPanel:not([open]) input { display: none; }
    #advancedPanel {
      border-top: 1px solid var(--border);
      padding-top: 8px;
    }
    .probe-group { margin-top: 6px; }
    .probe-group .row { margin-top: 6px; }
    .journal-summary {
      border: 0;
      border-left: 2px solid color-mix(in srgb, var(--border) 78%, Canvas 22%);
      border-radius: 0;
      padding: 3px 0 3px 10px;
      display: grid;
      gap: 6px;
      font-size: 0.8rem;
      background: transparent;
    }
    .journal-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: 8px;
      max-height: 240px;
      overflow: auto;
    }
    .journal-item {
      border: 0;
      border-left: 2px solid color-mix(in srgb, var(--border) 75%, Canvas 25%);
      border-radius: 0;
      padding: 5px 0 5px 10px;
      font-size: 0.84rem;
      background: transparent;
    }
    .journal-meta { font-size: 0.76rem; color: var(--muted); margin-bottom: 5px; }
    pre {
      margin: 0;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 9px;
      background: transparent;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 260px;
      overflow: auto;
      font-size: 0.79rem;
    }
    #qrCode img, #qrCode canvas {
      width: 100%;
      max-width: 220px;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 8px;
      background: #fff;
    }
    .section-rule {
      border-top: 1px solid color-mix(in srgb, var(--border) 72%, Canvas 28%);
      padding-top: 12px;
    }
    @media (min-width: 760px) {
      .app { padding: 18px; }
      .grid.two { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="card header-card">
      <h1>Even Hub Starter Kit</h1>
      <p class="muted">Mobile-first test helper for human hardware validation. Use this to guide repeatable checks on real devices.</p>
      <div class="pill-row">
        <span class="pill">Static site · no build step</span>
        <span class="pill">HTTPS recommended</span>
        <span class="pill">Cache-busted QR flow</span>
      </div>
    </section>

    <section class="card section-rule">
      <h2>Recommended Test Loop</h2>
      <p class="tiny muted">Default path: follow each numbered step and watch status updates.</p>
      <ol class="step-list">
        <li class="step-item">
          <div class="step-head"><strong>1) Generate QR (cache-busted)</strong><span id="stepStatusQr" class="step-status not-run">not run</span></div>
          <p class="tiny muted">Create a fresh QR URL so your device loads the newest build.</p>
          <div class="row"><button id="btnGenerateQr" class="primary-btn">Generate Fresh QR</button></div>
          <p class="tiny"><strong>URL:</strong> <span id="qrUrl">(not generated yet)</span></p>
          <p class="tiny"><strong>Timestamp:</strong> <span id="qrTimestamp">(not generated yet)</span></p>
          <div id="qrCode" aria-label="QR code output"></div>
        </li>
        <li class="step-item">
          <div class="step-head"><strong>2) Boot / Reconnect</strong><span id="stepStatusBoot" class="step-status not-run">not run</span></div>
          <p class="tiny muted">Connect to bridge runtime and confirm readiness.</p>
          <div class="row"><button id="btnBoot" class="primary-btn">Boot / Reconnect</button></div>
        </li>
        <li class="step-item">
          <div class="step-head"><strong>3) Run Hello World Demo</strong><span id="stepStatusHello" class="step-status not-run">not run</span></div>
          <p class="tiny muted">Try startup page creation up to 3 times with short delays.</p>
          <div class="row"><button id="btnHelloWorld" class="primary-btn">Run Hello World Demo</button></div>
        </li>
        <li class="step-item">
          <div class="step-head"><strong>4) Record confirmation</strong><span id="stepStatusJournal" class="step-status not-run">not run</span></div>
          <p class="tiny muted">Save your outcome with timestamp + notes for later handoff.</p>
        </li>
      </ol>
    </section>

    <section class="card section-rule">
      <h2>Live Status</h2>
      <div class="status-grid">
        <div class="status-cell">SDK: <span id="sdkStatus" class="bad">not loaded</span></div>
        <div class="status-cell">flutter_inappwebview: <span id="fiawvStatus" class="bad">unknown</span></div>
        <div class="status-cell">Bridge ready: <span id="bridgeStatus" class="bad">unknown</span></div>
        <div class="status-cell">Startup page: <span id="startupStatus" class="bad">not created</span></div>
      </div>
    </section>

    <section class="card section-rule">
      <details id="advancedPanel">
        <summary>Advanced probes (optional)</summary>
        <p class="tiny muted">Collapsed by default so the main flow stays focused.</p>
        <input id="advancedSearch" type="search" placeholder="Search advanced probes (example: audio)" />

        <div class="probe-group" data-group="Bridge">
          <h3>Bridge</h3>
          <div class="row">
            <button data-probe="Bridge" id="btnGetUser">getUserInfo()</button>
            <button data-probe="Bridge" id="btnGetDevice">getDeviceInfo()</button>
          </div>
        </div>

        <div class="probe-group" data-group="Page">
          <h3>Page</h3>
          <div class="row">
            <button data-probe="Page" id="btnCreateStartup">createStartUpPageContainer()</button>
            <button data-probe="Page" id="btnTextUpgrade">textContainerUpgrade()</button>
            <button data-probe="Page" id="btnRebuild">rebuildPageContainer()</button>
            <button data-probe="Page" id="btnShutdown">shutDownPageContainer()</button>
          </div>
        </div>

        <div class="probe-group" data-group="Storage">
          <h3>Storage</h3>
          <div class="row">
            <button data-probe="Storage" id="btnSetLS">setLocalStorage()</button>
            <button data-probe="Storage" id="btnGetLS">getLocalStorage()</button>
          </div>
        </div>

        <div class="probe-group" data-group="Audio">
          <h3>Audio</h3>
          <div class="row">
            <button data-probe="Audio" id="btnStartMic">audioControl(true)</button>
            <button data-probe="Audio" id="btnStopMic">audioControl(false)</button>
          </div>
        </div>
      </details>
    </section>

    <section class="grid two section-rule">
      <div class="card">
        <h2>Capabilities Matrix (auto-filled)</h2>
        <pre id="matrix">(nothing yet)</pre>
      </div>

      <div class="card">
        <h2>Developer Journal</h2>
        <p class="tiny muted">Entries are saved in this browser using localStorage.</p>

        <div class="journal-summary" id="journalSummary">Loading summary…</div>

        <label for="journalOutcome" class="tiny"><strong>Outcome</strong></label>
        <select id="journalOutcome">
          <option value="success">Success / win</option>
          <option value="failure">Failure / blocker</option>
        </select>

        <label class="tiny" for="journalNotes"><strong>Notes</strong></label>
        <textarea id="journalNotes" placeholder="What happened on the real device? Include anything that helps your next test run."></textarea>

        <div class="row">
          <button id="btnJournalConfirm" class="primary-btn">Record confirmation</button>
          <button id="btnJournalReset">Reset journal</button>
        </div>
        <div class="row">
          <button id="btnCopySummary">Copy Summary</button>
          <button id="btnCopyFullReport">Copy Full Report</button>
          <button id="btnDownloadReport">Download Report (.md)</button>
        </div>

        <p id="journalEmpty" class="tiny muted">No history yet.</p>
        <ol id="journalList" class="journal-list"></ol>
      </div>
    </section>

    <section class="card section-rule">
      <h2>Log</h2>
      <pre id="log"></pre>
    </section>
  </main>

  <script src="./vendor/qrcode.min.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
